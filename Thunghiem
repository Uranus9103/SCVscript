-- Cấu hình ESP
local ESP_CONFIG = {
    Size = UDim2.new(0,150,0,40),
    Offset = Vector3.new(0,5,0),

    Text = {
        Font = Enum.Font.Arcade,
        Color = Color3.fromRGB(85,255,85),
        StrokeColor = Color3.fromRGB(0,0,0),
        StrokeTransparency = 0,
    },

    Background = {
        Color = Color3.fromRGB(0,0,0),
        Transparency = 0.4,
    },

    Border = {
        Enabled = true,
        Thickness = 2,
        Color = Color3.fromRGB(0,0,0),
    }
}

-- Danh sách tên cần hiện
local ALLOWED_NAMES = {
    ["Noobini Pizzanini"] = true,
    ["Lirili Larila"] = true,
    ["Tim Cheese"] = true,
}

-- Service
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

local plotsFolder = Workspace:WaitForChild("Plots")
local espList = {}
local espEnabled = false

-- Xóa ESP
local function clearESP()
    for _, esp in pairs(espList) do
        if esp and esp.Parent then esp:Destroy() end
    end
    table.clear(espList)
end

-- Lấy DisplayName + tọa độ
local function getAnimalNameAndPos(podium)
    local overhead = podium:FindFirstChild("Base")
        and podium.Base:FindFirstChild("Spawn")
        and podium.Base.Spawn:FindFirstChild("Attachment")
        and podium.Base.Spawn.Attachment:FindFirstChild("AnimalOverhead")

    if overhead and overhead:FindFirstChild("DisplayName") then
        local label = overhead.DisplayName
        if label:IsA("TextLabel") then
            local name = label.Text
            if ALLOWED_NAMES[name] then
                local pos = podium.Base.Position
                local posText = string.format("X: %.1f, Y: %.1f, Z: %.1f", pos.X, pos.Y, pos.Z)
                return name, posText
            end
        end
    end
    return nil, nil
end

-- Tạo ESP
local function createESP(part, text)
    local gui = Instance.new("BillboardGui")
    gui.Name = "AnimalESP"
    gui.Adornee = part
    gui.Size = ESP_CONFIG.Size
    gui.StudsOffset = ESP_CONFIG.Offset
    gui.AlwaysOnTop = true

    local bg = Instance.new("Frame")
    bg.Size = UDim2.new(1,0,1,0)
    bg.BackgroundColor3 = ESP_CONFIG.Background.Color
    bg.BackgroundTransparency = ESP_CONFIG.Background.Transparency
    bg.BorderSizePixel = 0
    bg.Parent = gui

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Font = ESP_CONFIG.Text.Font
    label.TextColor3 = ESP_CONFIG.Text.Color
    label.TextStrokeTransparency = ESP_CONFIG.Text.StrokeTransparency
    label.TextStrokeColor3 = ESP_CONFIG.Text.StrokeColor
    label.Text = text
    label.Parent = bg

    if ESP_CONFIG.Border.Enabled then
        local stroke = Instance.new("UIStroke")
        stroke.Thickness = ESP_CONFIG.Border.Thickness
        stroke.Color = ESP_CONFIG.Border.Color
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        stroke.Parent = bg
    end

    gui.Parent = part
    table.insert(espList,gui)
end

-- Loop cập nhật ESP
task.spawn(function()
    while true do
        if espEnabled then
            clearESP()
            for _, plot in ipairs(plotsFolder:GetChildren()) do
                if plot:IsA("Model") and plot:FindFirstChild("AnimalPodiums") then
                    for _, podium in ipairs(plot.AnimalPodiums:GetChildren()) do
                        if podium:IsA("Model") and podium:FindFirstChild("Base") then
                            local name, posText = getAnimalNameAndPos(podium)
                            if name and posText then
                                createESP(podium.Base, name .. "\n" .. posText)
                            end
                        end
                    end
                end
            end
        else
            clearESP()
        end
        task.wait(0.5)
    end
end)

-- GUI Toggle
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ESPControl"
screenGui.ResetOnSpawn = false
screenGui.Parent = localPlayer:WaitForChild("PlayerGui")

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0,120,0,40)
toggleBtn.Position = UDim2.new(1,-130,1,-50) -- góc phải dưới màn hình
toggleBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 16
toggleBtn.Text = "ESP: OFF"
toggleBtn.Parent = screenGui

toggleBtn.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    toggleBtn.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    toggleBtn.BackgroundColor3 = espEnabled and Color3.fromRGB(0,170,0) or Color3.fromRGB(50,50,50)
end)
