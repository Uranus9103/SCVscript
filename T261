local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local InsertService = game:GetService("InsertService")
local player = Players.LocalPlayer

-- ===== CẤU HÌNH =====
local FOOT_MODEL_ID = 16458315457
local ORBIT_MODEL_ID = 65288880
local NUM_ORBIT = 6
local ORBIT_RADIUS = 5
local ORBIT_HEIGHT = 3
local GUI_SIZE = UDim2.new(0,150,0,50)
local GUI_POSITION = UDim2.new(0.5,-75,0.9,0)
-- ====================

local active = false
local footModel
local orbitModels = {}
local angle = 0

-- ==== Tạo GUI nút bật/tắt ====
local playerGui = player:WaitForChild("PlayerGui")
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ModelToggleGui"
screenGui.Parent = playerGui

local button = Instance.new("TextButton")
button.Size = GUI_SIZE
button.Position = GUI_POSITION
button.Text = "Bật/ Tắt Model"
button.Parent = screenGui

-- ==== Hàm spawn model dưới chân ====
local function spawnFoot()
    if footModel and footModel.Parent then footModel:Destroy() end
    local success, model = pcall(function()
        return InsertService:LoadAsset(FOOT_MODEL_ID)
    end)
    if not success or not model then return end
    footModel = model
    footModel.Parent = workspace
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        local primary = footModel.PrimaryPart or footModel:FindFirstChildWhichIsA("BasePart")
        if primary then
            footModel.PrimaryPart = primary
            footModel:SetPrimaryPartCFrame(hrp.CFrame - Vector3.new(0, primary.Size.Y/2, 0))
        end
    end
end

-- ==== Hàm spawn quả cầu quay vòng ====
local function spawnOrbit()
    for _, m in pairs(orbitModels) do
        if m and m.Parent then m:Destroy() end
    end
    orbitModels = {}

    local success, model = pcall(function()
        return InsertService:LoadAsset(ORBIT_MODEL_ID)
    end)
    if not success or not model then return end

    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    for i=1,NUM_ORBIT do
        local clone = model:Clone()
        clone.Parent = workspace
        local primary = clone.PrimaryPart or clone:FindFirstChildWhichIsA("BasePart")
        if primary then clone.PrimaryPart = primary end
        table.insert(orbitModels, clone)
    end

    -- Quay vòng
    RunService.Heartbeat:Connect(function(dt)
        if not active or not hrp then return end
        angle = angle + dt
        for i, orb in ipairs(orbitModels) do
            if orb and orb.PrimaryPart then
                local theta = (2*math.pi/NUM_ORBIT)*i + angle
                local x = math.cos(theta) * ORBIT_RADIUS
                local z = math.sin(theta) * ORBIT_RADIUS
                orb:SetPrimaryPartCFrame(hrp.CFrame + Vector3.new(x, ORBIT_HEIGHT, z))
            end
        end
    end)
end

-- ==== Toggle bật/tắt ====
local function toggleEffect()
    active = not active
    if active then
        spawnFoot()
        spawnOrbit()
    else
        if footModel and footModel.Parent then footModel:Destroy() end
        for _, orb in pairs(orbitModels) do
            if orb and orb.Parent then orb:Destroy() end
        end
        orbitModels = {}
    end
end

-- ==== Gán sự kiện nút GUI ====
button.MouseButton1Click:Connect(toggleEffect)
