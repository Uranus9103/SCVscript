-- LocalScript trong StarterPlayerScripts

local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local root = character:WaitForChild("HumanoidRootPart")

-- Bi·∫øn l∆∞u v·ªã tr√≠
local savedCFrame = nil
local VOID_Y = -40 -- n·∫øu r∆°i th·∫•p h∆°n m·ª©c n√†y th√¨ s·∫Ω d·ªãch chuy·ªÉn v·ªÅ

-- UI
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "SaveTeleportUI"
gui.ResetOnSpawn = false

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.fromOffset(120, 50)
toggleBtn.Position = UDim2.new(0, 20, 0.8, 0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(52, 152, 219)
toggleBtn.Text = "Menu"
toggleBtn.TextScaled = true
toggleBtn.Parent = gui
Instance.new("UICorner", toggleBtn)

local menuFrame = Instance.new("Frame")
menuFrame.Size = UDim2.fromOffset(220, 170)
menuFrame.Position = UDim2.new(0, 20, 0.5, -85)
menuFrame.BackgroundColor3 = Color3.fromRGB(44, 62, 80)
menuFrame.Visible = false
menuFrame.Parent = gui
Instance.new("UICorner", menuFrame)

local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.fromOffset(180, 40)
saveBtn.Position = UDim2.new(0.5, -90, 0, 20)
saveBtn.BackgroundColor3 = Color3.fromRGB(39, 174, 96)
saveBtn.Text = "L∆∞u v·ªã tr√≠"
saveBtn.TextScaled = true
saveBtn.Parent = menuFrame
Instance.new("UICorner", saveBtn)

local backBtn = Instance.new("TextButton")
backBtn.Size = UDim2.fromOffset(180, 40)
backBtn.Position = UDim2.new(0.5, -90, 0, 70)
backBtn.BackgroundColor3 = Color3.fromRGB(231, 76, 60)
backBtn.Text = "V·ªÅ v·ªã tr√≠"
backBtn.TextScaled = true
backBtn.Parent = menuFrame
Instance.new("UICorner", backBtn)

local jumpBtn = Instance.new("TextButton")
jumpBtn.Size = UDim2.fromOffset(180, 40)
jumpBtn.Position = UDim2.new(0.5, -90, 0, 120)
jumpBtn.BackgroundColor3 = Color3.fromRGB(155, 89, 182)
jumpBtn.Text = "B·∫≠t nh·∫£y v√¥ h·∫°n"
jumpBtn.TextScaled = true
jumpBtn.Parent = menuFrame
Instance.new("UICorner", jumpBtn)

-- Toggle menu
toggleBtn.MouseButton1Click:Connect(function()
	menuFrame.Visible = not menuFrame.Visible
end)

-- L∆∞u v·ªã tr√≠
saveBtn.MouseButton1Click:Connect(function()
	character = player.Character or player.CharacterAdded:Wait()
	root = character:WaitForChild("HumanoidRootPart")
	savedCFrame = root.CFrame
	saveBtn.Text = "ƒê√£ l∆∞u!"
	task.delay(1.5, function() saveBtn.Text = "L∆∞u v·ªã tr√≠" end)
end)

-- V·ªÅ v·ªã tr√≠ b·∫±ng n√∫t
backBtn.MouseButton1Click:Connect(function()
	if savedCFrame then
		character = player.Character or player.CharacterAdded:Wait()
		root = character:WaitForChild("HumanoidRootPart")
		root.CFrame = savedCFrame + Vector3.new(0,3,0)
	else
		backBtn.Text = "Ch∆∞a c√≥ v·ªã tr√≠!"
		task.delay(1.5, function() backBtn.Text = "V·ªÅ v·ªã tr√≠" end)
	end
end)

-- üî• T·ª± ƒë·ªông v·ªÅ khi ch·∫øt ho·∫∑c r∆°i void
local function autoReturn()
	if savedCFrame then
		task.wait(0.2) -- ch·ªù nh√¢n v·∫≠t spawn l·∫°i
		character = player.Character or player.CharacterAdded:Wait()
		root = character:WaitForChild("HumanoidRootPart")
		root.CFrame = savedCFrame + Vector3.new(0,3,0)
	end
end

-- Khi nh√¢n v·∫≠t ch·∫øt ‚Üí v·ªÅ ch·ªó l∆∞u
humanoid.Died:Connect(function()
	player.CharacterAdded:Wait()
	autoReturn()
end)

-- Li√™n t·ª•c ki·ªÉm tra r∆°i void
game:GetService("RunService").Heartbeat:Connect(function()
	if savedCFrame and root then
		if root.Position.Y < VOID_Y then
			autoReturn()
		end
	end
end)

-- =========================
-- üöÄ H·ªá th·ªëng Nh·∫£y V√¥ H·∫°n
-- =========================
local UIS = game:GetService("UserInputService")
local infiniteJumpEnabled = false

jumpBtn.MouseButton1Click:Connect(function()
	infiniteJumpEnabled = not infiniteJumpEnabled
	if infiniteJumpEnabled then
		jumpBtn.Text = "T·∫Øt nh·∫£y v√¥ h·∫°n"
		jumpBtn.BackgroundColor3 = Color3.fromRGB(142, 68, 173)
	else
		jumpBtn.Text = "B·∫≠t nh·∫£y v√¥ h·∫°n"
		jumpBtn.BackgroundColor3 = Color3.fromRGB(155, 89, 182)
	end
end)

UIS.JumpRequest:Connect(function()
	if infiniteJumpEnabled and humanoid then
		humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
	end
end)
