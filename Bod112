-- LocalScript trong StarterPlayerScripts
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local plotsFolder = workspace:WaitForChild("Plots")

-- Tạo GUI nút bật/tắt
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ESPGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 120, 0, 40)
toggleButton.Position = UDim2.new(0, 20, 0, 200)
toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleButton.TextColor3 = Color3.fromRGB(0, 255, 0)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 18
toggleButton.Text = "ESP: OFF"
toggleButton.Parent = screenGui

-- Biến trạng thái
local ESPEnabled = false
local connections = {}
local espObjects = {}

-- Hàm tạo ESP
local function createESP(attachment, displayName)
	local billboard = Instance.new("BillboardGui")
	billboard.Name = "ESP_" .. displayName.Text
	billboard.Adornee = attachment
	billboard.Size = UDim2.new(0, 200, 0, 50)
	billboard.AlwaysOnTop = true
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.Parent = player:WaitForChild("PlayerGui")

	local textLabel = Instance.new("TextLabel")
	textLabel.Size = UDim2.new(1, 0, 1, 0)
	textLabel.BackgroundTransparency = 1
	textLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
	textLabel.Font = Enum.Font.GothamBold
	textLabel.TextScaled = true
	textLabel.Parent = billboard

	local conn = RunService.RenderStepped:Connect(function()
		if ESPEnabled and attachment and attachment.Parent then
			local pos = attachment.WorldPosition or attachment.Position
			textLabel.Text = string.format("%s\nX: %.1f Y: %.1f Z: %.1f",
				displayName.Text, pos.X, pos.Y, pos.Z)
			billboard.Enabled = true
		else
			billboard.Enabled = false
		end
	end)

	table.insert(connections, conn)
	table.insert(espObjects, billboard)
end

-- Quét toàn bộ Plot để tạo ESP
for _, plot in pairs(plotsFolder:GetChildren()) do
	if plot:FindFirstChild("AnimalPodiums") then
		for _, podium in pairs(plot.AnimalPodiums:GetChildren()) do
			local spawnBase = podium:FindFirstChild("Base")
			if spawnBase and spawnBase:FindFirstChild("Spawn") then
				local attachment = spawnBase.Spawn:FindFirstChild("Attackchment")
				if attachment and attachment:FindFirstChild("AnimalOverhead") then
					local overhead = attachment.AnimalOverhead
					local displayName = overhead:FindFirstChild("DisplayName")

					if displayName and displayName:IsA("TextLabel") then
						createESP(attachment, displayName)
					end
				end
			end
		end
	end
end

-- Nút bật/tắt
toggleButton.MouseButton1Click:Connect(function()
	ESPEnabled = not ESPEnabled
	if ESPEnabled then
		toggleButton.Text = "ESP: ON"
		toggleButton.TextColor3 = Color3.fromRGB(0, 255, 0)
	else
		toggleButton.Text = "ESP: OFF"
		toggleButton.TextColor3 = Color3.fromRGB(255, 0, 0)
	end
end)
