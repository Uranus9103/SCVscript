-- Cấu hình ESP
local ESP_CONFIG = {
    Size = UDim2.new(0,80,0,25),
    Offset = Vector3.new(0,3,0), -- offset cao hơn Spawn
    Text = {
        Font = Enum.Font.Arcade,
        Color = Color3.fromRGB(85,255,85),
        StrokeColor = Color3.fromRGB(0,0,0),
        StrokeTransparency = 0,
    },
    Background = {
        Color = Color3.fromRGB(0,0,0),
        Transparency = 0.4,
    },
    Border = {
        Enabled = true,
        Thickness = 2,
        Color = Color3.fromRGB(0,0,0),
    }
}

-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

-- Danh sách Brainrot được hiển thị (từ cao xuống thấp)
local BRAINROT_LIST = {
    "Ketupat Kepat",
    "La Supreme Combinasion",
    "Sammyini Spyderini",
    "Nooo My Hotspot",
    "Los Matteos",
    "Esok Sekolah",
    "Los Hotspotsitos",
    "Karkerkar Kurkur",
    "Los Combinasionas",
    "Dragon Cannelloni",
    "Agarrini la Palini",
    "Chicleteira Bicicleteira",
    "Las Vaquitas Saturnitas",
    "Pot Hotspot",
    "Tortuginni Dragonfruitini",
    "Garama and Madundung",
    "Nuclearo Dinossauro",
"Lirili Larila",
"Noobini Pizzanini",

}

-- Chạy script
_G.runMyESPScript = true
local plotsFolder = Workspace:WaitForChild("Plots")
local espList = {}

-- Xóa ESP cũ
local function clearESP()
    for _, esp in pairs(espList) do
        if esp and esp.Parent then esp:Destroy() end
    end
    table.clear(espList)
end

-- Lấy part chính là Spawn
local function findESPPart(plot)
    local spawnPart = plot:FindFirstChild("AnimalPodiums")
    spawnPart = spawnPart and spawnPart:FindFirstChild("Base")
    spawnPart = spawnPart and spawnPart:FindFirstChild("Spawn")
    return spawnPart
end

-- Lấy tên Brainrot
local function getBrainrotName(plot)
    local success, name = pcall(function()
        local display = plot:FindFirstChild("AnimalPodiums")
        if display then
            display = display:FindFirstChild("Base")
            display = display and display:FindFirstChild("Spawn")
            display = display and display:FindFirstChild("AnimalOverhead")
            display = display and display:FindFirstChild("DisplayName")
            return display and display.Text
        end
        return nil
    end)
    return success and name or nil
end

-- Kiểm tra xem tên có nằm trong danh sách không
local function isValidBrainrot(name)
    for _, validName in ipairs(BRAINROT_LIST) do
        if name == validName then
            return true
        end
    end
    return false
end

-- Tạo ESP
local function createESP(part, text)
    local gui = Instance.new("BillboardGui")
    gui.Name = "BrainrotESP"
    gui.Adornee = part
    gui.Size = ESP_CONFIG.Size
    gui.StudsOffset = ESP_CONFIG.Offset
    gui.AlwaysOnTop = true

    local bg = Instance.new("Frame")
    bg.Size = UDim2.new(1,0,1,0)
    bg.BackgroundColor3 = ESP_CONFIG.Background.Color
    bg.BackgroundTransparency = ESP_CONFIG.Background.Transparency
    bg.BorderSizePixel = 0
    bg.Parent = gui

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Font = ESP_CONFIG.Text.Font
    label.TextColor3 = ESP_CONFIG.Text.Color
    label.TextStrokeTransparency = ESP_CONFIG.Text.StrokeTransparency
    label.TextStrokeColor3 = ESP_CONFIG.Text.StrokeColor
    label.Text = text
    label.Parent = bg

    if ESP_CONFIG.Border.Enabled then
        local stroke = Instance.new("UIStroke")
        stroke.Thickness = ESP_CONFIG.Border.Thickness
        stroke.Color = ESP_CONFIG.Border.Color
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        stroke.Parent = bg
    end

    gui.Parent = part
    table.insert(espList, gui)
end

-- Vòng lặp chính: quét Plot, lọc Brainrot, sắp xếp theo danh sách
spawn(function()
    while _G.runMyESPScript do
        clearESP()

        -- Tạo bảng tạm chứa plot hợp lệ và thứ tự danh sách
        local validPlots = {}
        for _, plot in ipairs(plotsFolder:GetChildren()) do
            if plot:IsA("Model") then
                local part = findESPPart(plot)
                local name = getBrainrotName(plot)
                if part and name and isValidBrainrot(name) then
                    -- Lưu kèm thứ tự trong danh sách để sắp xếp
                    local order = table.find(BRAINROT_LIST, name)
                    table.insert(validPlots, {plot=plot, part=part, name=name, order=order})
                end
            end
        end

        -- Sắp xếp theo thứ tự danh sách (từ cao xuống thấp)
        table.sort(validPlots, function(a,b) return a.order < b.order end)

        -- Tạo ESP theo thứ tự
        for _, info in ipairs(validPlots) do
            createESP(info.part, info.name)
        end

        task.wait(0.3)
    end
end)
