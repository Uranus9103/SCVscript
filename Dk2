local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local player = Players.LocalPlayer

-- L∆∞u h√†nh ƒë·ªông
local recordedActions = {}
local isRecording = false
local isPlaying = false

-- GUI
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
local recordBtn = Instance.new("TextButton", ScreenGui)
local playBtn = Instance.new("TextButton", ScreenGui)
local stopBtn = Instance.new("TextButton", ScreenGui)

ScreenGui.Name = "MacroGUI"

recordBtn.Size = UDim2.new(0,100,0,40)
recordBtn.Position = UDim2.new(0,20,0,100)
recordBtn.Text = "üî¥ Ghi"

playBtn.Size = UDim2.new(0,100,0,40)
playBtn.Position = UDim2.new(0,20,0,150)
playBtn.Text = "‚ñ∂Ô∏è L·∫∑p (‚àû)"

stopBtn.Size = UDim2.new(0,100,0,40)
stopBtn.Position = UDim2.new(0,20,0,200)
stopBtn.Text = "‚èπ D·ª´ng"

-- H√†m b·∫Øt ƒë·∫ßu ghi
local function startRecording()
	recordedActions = {}
	isRecording = true
	isPlaying = false
	print("B·∫Øt ƒë·∫ßu ghi...")
end

-- H√†m ph√°t l·∫°i (loop v√¥ h·∫°n)
local function playRecording()
	if #recordedActions == 0 then return end
	isPlaying = true
	isRecording = false
	print("Ph√°t l·∫°i (Loop)...")

	spawn(function()
		while isPlaying do
			for _, action in ipairs(recordedActions) do
				if not isPlaying then break end
				task.wait(action.delay)

				-- Gi·∫£ l·∫≠p l·∫°i input
				if action.type == "Key" then
					VirtualInputManager:SendKeyEvent(true, action.key, false, game)
					task.wait(0.05)
					VirtualInputManager:SendKeyEvent(false, action.key, false, game)
				elseif action.type == "Mouse" then
					VirtualInputManager:SendMouseButtonEvent(action.pos.X, action.pos.Y, 0, true, game, 0)
					task.wait(0.05)
					VirtualInputManager:SendMouseButtonEvent(action.pos.X, action.pos.Y, 0, false, game, 0)
				end
			end
		end
	end)
end

-- H√†m d·ª´ng
local function stopPlayback()
	isPlaying = false
	isRecording = false
	print("D·ª´ng l·∫°i")
end

-- B·∫Øt s·ª± ki·ªán ph√≠m/mouse khi ƒëang ghi
local lastTime = tick()
UserInputService.InputBegan:Connect(function(input, gpe)
	if not isRecording or gpe then return end
	local now = tick()
	local delay = now - lastTime
	lastTime = now

	if input.UserInputType == Enum.UserInputType.Keyboard then
		table.insert(recordedActions, {type="Key", key=input.KeyCode, delay=delay})
	elseif input.UserInputType == Enum.UserInputType.MouseButton1 then
		table.insert(recordedActions, {type="Mouse", pos=UserInputService:GetMouseLocation(), delay=delay})
	end
end)

-- G·∫Øn s·ª± ki·ªán n√∫t GUI
recordBtn.MouseButton1Click:Connect(startRecording)
playBtn.MouseButton1Click:Connect(playRecording)
stopBtn.MouseButton1Click:Connect(stopPlayback)
