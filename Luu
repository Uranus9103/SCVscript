local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local PathfindingService = game:GetService("PathfindingService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- üîπ L·∫•y nh√† ri√™ng c·ªßa ng∆∞·ªùi ch∆°i (Part trong Workspace t√™n: Home_[UserId])
local function getHomePart()
	return workspace:FindFirstChild("Home_" .. player.UserId)
end

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "HomeGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 140, 0, 50)
button.Position = UDim2.new(0, 20, 0, 200)
button.Text = "T·ª± bay v·ªÅ nh√†"
button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
button.Parent = gui

-- Tr·∫°ng th√°i
local autoFlying = false
local currentTween

-- H√†m tween m∆∞·ª£t
local function tweenTo(targetPos)
	if not humanoidRootPart then return end
	if currentTween then currentTween:Cancel() end

	local distance = (targetPos - humanoidRootPart.Position).Magnitude
	local flyTime = distance / 60 -- ch·ªânh t·ªëc ƒë·ªô
	local tweenInfo = TweenInfo.new(flyTime, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
	local goal = { CFrame = CFrame.new(targetPos) }
	currentTween = TweenService:Create(humanoidRootPart, tweenInfo, goal)
	currentTween:Play()
	return currentTween
end

-- H√†m bay theo path
local function flyPath(homePart)
	if not humanoidRootPart or not homePart then return end

	local path = PathfindingService:CreatePath({
		AgentRadius = 5,
		AgentHeight = 6,
		AgentCanJump = true,
		AgentCanClimb = true
	})

	path:ComputeAsync(humanoidRootPart.Position, homePart.Position + Vector3.new(0,5,0))

	if path.Status == Enum.PathStatus.Complete then
		local waypoints = path:GetWaypoints()

		-- Bay qua t·ª´ng waypoint
		for _, waypoint in ipairs(waypoints) do
			if not autoFlying then break end
			local target = waypoint.Position + Vector3.new(0, 5, 0) -- bay cao h∆°n 5
			local tween = tweenTo(target)
			tween.Completed:Wait()
		end

		if autoFlying then
			button.Text = "ƒê√£ v·ªÅ nh√†"
			autoFlying = false
		end
	else
		button.Text = "Kh√¥ng t√¨m th·∫•y ƒë∆∞·ªùng!"
		autoFlying = false
	end
end

-- N√∫t b·∫≠t/t·∫Øt
button.MouseButton1Click:Connect(function()
	if autoFlying then
		-- H·ªßy bay
		if currentTween then currentTween:Cancel() end
		button.Text = "T·ª± bay v·ªÅ nh√†"
		button.BackgroundColor3 = Color3.fromRGB(50,200,50)
		autoFlying = false
	else
		local homePart = getHomePart()
		if not homePart then
			button.Text = "Kh√¥ng c√≥ nh√†!"
			return
		end

		-- B·∫Øt ƒë·∫ßu bay
		button.Text = "ƒêang bay..."
		button.BackgroundColor3 = Color3.fromRGB(200,50,50)
		autoFlying = true
		flyPath(homePart)
	end
end)

-- N·∫øu nh√¢n v·∫≠t respawn
player.CharacterAdded:Connect(function(char)
	character = char
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")
end)
