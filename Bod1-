-- Cấu hình ESP Minecraft
local ESP_CONFIG = {
    Text = {
        Font = Enum.Font.GothamBold,
        Color = Color3.fromRGB(0,255,128),
        StrokeColor = Color3.fromRGB(0,0,0),
        StrokeTransparency = 0,
        Size = UDim2.new(0,150,0,50),
        Offset = Vector3.new(0,7,0)
    },
    Box = {
        Enabled = true,
        Color = Color3.fromRGB(0,255,128),
        Thickness = 0.05, -- độ dày của viền
    }
}

-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

_G.runMinecraftESP = true
local plotsFolder = Workspace:WaitForChild("Plots")
local espList = {}

-- Xóa ESP hiện tại
local function clearESP()
    for _, esp in pairs(espList) do
        if esp and esp.Parent then esp:Destroy() end
    end
    table.clear(espList)
end

-- Lấy thời gian còn lại của plot
local function getRemainingTimeText(plot)
    for _, part in ipairs(plot:GetDescendants()) do
        if part:IsA("TextLabel") and part.Name=="RemainingTime" then
            return part.Text:gsub("s","")
        end
    end
    return nil
end

-- Tìm part chính của plot
local function findESPPart(plot)
    for _, part in ipairs(plot:GetDescendants()) do
        if part:IsA("BasePart") and (part.Name=="Main" or part.Name=="Hitbox") then
            return part
        end
    end
    for _, part in ipairs(plot:GetDescendants()) do
        if part:IsA("BasePart") then return part end
    end
    return nil
end

-- Tạo chữ 3D kiểu Minecraft
local function createMinecraftTextESP(part, text)
    local gui = Instance.new("BillboardGui")
    gui.Name = "MinecraftTextESP"
    gui.Adornee = part
    gui.Size = ESP_CONFIG.Text.Size
    gui.StudsOffset = ESP_CONFIG.Text.Offset
    gui.AlwaysOnTop = true

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1,0,1,0)
    frame.BackgroundTransparency = 1
    frame.Parent = gui

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Font = ESP_CONFIG.Text.Font
    label.TextColor3 = ESP_CONFIG.Text.Color
    label.TextStrokeColor3 = ESP_CONFIG.Text.StrokeColor
    label.TextStrokeTransparency = ESP_CONFIG.Text.StrokeTransparency
    label.Text = text
    label.Parent = frame

    gui.Parent = part
    table.insert(espList, gui)
end

-- Tạo box xung quanh part
local function createESPBox(part)
    if not ESP_CONFIG.Box.Enabled then return end
    local adornee = Instance.new("BoxHandleAdornment")
    adornee.Adornee = part
    adornee.Size = part.Size + Vector3.new(0.2,0.2,0.2)
    adornee.Color3 = ESP_CONFIG.Box.Color
    adornee.Transparency = 0
    adornee.AlwaysOnTop = true
    adornee.ZIndex = 5
    adornee.Parent = part
    table.insert(espList, adornee)
end

-- Vòng lặp chính
while _G.runMinecraftESP do
    clearESP()
    for _, plot in ipairs(plotsFolder:GetChildren()) do
        if plot:IsA("Model") then
            local part = findESPPart(plot)
            local seconds = getRemainingTimeText(plot)
            if part and seconds then
                createMinecraftTextESP(part, seconds.."s")
                createESPBox(part)
            end
        end
    end
    task.wait(0.3)
end

clearESP()
