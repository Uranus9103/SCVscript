-- Brainrot ESP Script
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer
local espFolder = Instance.new("Folder", CoreGui)
espFolder.Name = "BrainrotESP"

local function createEsp(character, displayName)
    -- Kiểm tra nếu character có PrimaryPart (thường là HumanoidRootPart)
    if not character:FindFirstChild("HumanoidRootPart") then
        return
    end

    local rootPart = character.HumanoidRootPart
    
    -- Tạo BillboardGui để hiển thị tên
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "BrainrotESP_" .. character.Name
    billboard.Adornee = rootPart
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0) -- Hiển thị phía trên character
    billboard.AlwaysOnTop = true
    billboard.Parent = espFolder

    -- Tạo TextLabel hiển thị tên
    local textLabel = Instance.new("TextLabel")
    textLabel.Name = "DisplayName"
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = displayName or character.Name
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextSize = 20
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Parent = billboard

    -- Thêm UIStroke để làm nổi bật chữ
    local uiStroke = Instance.new("UIStroke")
    uiStroke.Thickness = 2
    uiStroke.Color = Color3.fromRGB(0, 0, 0)
    uiStroke.Parent = textLabel

    -- Kết nối sự kiện khi character bị hủy
    character.Destroying:Connect(function()
        if billboard then
            billboard:Destroy()
        end
    end)
end

local function onCharacterAdded(character, player, displayName)
    -- Đợi cho character load hoàn chỉnh
    character:WaitForChild("HumanoidRootPart")
    
    -- Tạo ESP
    createEsp(character, displayName)
end

-- Kết nối với player mới tham gia
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        -- Lấy DisplayName từ player (có thể thay đổi tùy game)
        local displayName = player.DisplayName or player.Name
        onCharacterAdded(character, player, displayName)
    end)
end)

-- Xử lý cho local player
if localPlayer.Character then
    local displayName = localPlayer.DisplayName or localPlayer.Name
    onCharacterAdded(localPlayer.Character, localPlayer, displayName)
end

localPlayer.CharacterAdded:Connect(function(character)
    local displayName = localPlayer.DisplayName or localPlayer.Name
    onCharacterAdded(character, localPlayer, displayName)
end)

-- Dọn dẹp khi script bị hủy
espFolder.Destroying:Connect(function()
    espFolder:Destroy()
end)

print("Brainrot ESP loaded! Displaying names above characters.")
