local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Thá»i gian máº·c Ä‘á»‹nh
local respawnTime = 20
local autoEnabled = false
local countdown = respawnTime

-- Cháº¡y tháº³ng
local forwardEnabled = false
local forwardConnection

--====================================
-- GUI
--====================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BaseSystemGUI"
ScreenGui.ResetOnSpawn = false -- giá»¯ láº¡i UI khi reset
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Báº£ng chÃ­nh
local mainFrame = Instance.new("Frame", ScreenGui)
mainFrame.Size = UDim2.new(0, 220, 0, 190)
mainFrame.Position = UDim2.new(0, 20, 0, 100)
mainFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
mainFrame.Active = true
mainFrame.Draggable = true

-- TiÃªu Ä‘á»
local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1,0,0,30)
title.BackgroundColor3 = Color3.fromRGB(20,20,20)
title.TextColor3 = Color3.new(1,1,1)
title.Text = "âš” Auto Base System"

-- NÃºt báº­t/táº¯t auto reset
local toggleBtn = Instance.new("TextButton", mainFrame)
toggleBtn.Size = UDim2.new(0.9,0,0,30)
toggleBtn.Position = UDim2.new(0.05,0,0,40)
toggleBtn.Text = "â–¶ï¸ Báº­t Auto Reset"
toggleBtn.BackgroundColor3 = Color3.fromRGB(0,120,0)
toggleBtn.TextColor3 = Color3.new(1,1,1)

-- Ã” nháº­p sá»‘ giÃ¢y
local timeBox = Instance.new("TextBox", mainFrame)
timeBox.Size = UDim2.new(0.9,0,0,30)
timeBox.Position = UDim2.new(0.05,0,0,80)
timeBox.PlaceholderText = "Nháº­p thá»i gian (giÃ¢y)"
timeBox.Text = ""
timeBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
timeBox.TextColor3 = Color3.new(1,1,1)

-- NÃºt auto cháº¡y tháº³ng
local forwardBtn = Instance.new("TextButton", mainFrame)
forwardBtn.Size = UDim2.new(0.9,0,0,30)
forwardBtn.Position = UDim2.new(0.05,0,0,120)
forwardBtn.Text = "â–¶ï¸ Auto Forward"
forwardBtn.BackgroundColor3 = Color3.fromRGB(0,120,0)
forwardBtn.TextColor3 = Color3.new(1,1,1)

-- Label tráº¡ng thÃ¡i
local statusLabel = Instance.new("TextLabel", mainFrame)
statusLabel.Size = UDim2.new(0.9,0,0,30)
statusLabel.Position = UDim2.new(0.05,0,0,160)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.new(1,1,1)
statusLabel.Text = "Tráº¡ng thÃ¡i: Táº¯t"

--====================================
-- Chá»©c nÄƒng auto reset
--====================================
local function startAuto()
	autoEnabled = true
	countdown = respawnTime
	toggleBtn.Text = "â¹ Táº¯t Auto Reset"
	toggleBtn.BackgroundColor3 = Color3.fromRGB(120,0,0)
	statusLabel.Text = "Tráº¡ng thÃ¡i: Báº­t ("..respawnTime.."s)"
	
	-- vÃ²ng Ä‘áº¿m ngÆ°á»£c reset
	task.spawn(function()
		while autoEnabled do
			for i = respawnTime,1,-1 do
				if not autoEnabled then break end
				countdown = i
				statusLabel.Text = "Reset sau: "..countdown.."s"
				task.wait(1)
			end
			if autoEnabled and player.Character and player.Character:FindFirstChild("Humanoid") then
				player.Character.Humanoid.Health = 0 -- reset
			end
		end
	end)
end

local function stopAuto()
	autoEnabled = false
	toggleBtn.Text = "â–¶ï¸ Báº­t Auto Reset"
	toggleBtn.BackgroundColor3 = Color3.fromRGB(0,120,0)
	statusLabel.Text = "Tráº¡ng thÃ¡i: Táº¯t"
end

--====================================
-- Chá»©c nÄƒng auto cháº¡y tháº³ng
--====================================
local function startForward()
	if forwardEnabled then return end
	forwardEnabled = true
	forwardBtn.Text = "â¹ Dá»«ng Forward"
	forwardBtn.BackgroundColor3 = Color3.fromRGB(120,0,0)
	statusLabel.Text = "ðŸƒ Äang cháº¡y tháº³ng..."

	local char = player.Character
	if not char then return end
	local humanoid = char:WaitForChild("Humanoid")

	forwardConnection = RunService.Heartbeat:Connect(function()
		if forwardEnabled and humanoid and humanoid.Health > 0 then
			humanoid:Move(Vector3.new(0,0,-1), true) -- Ä‘i tháº³ng
		else
			humanoid:Move(Vector3.new(0,0,0), true)
		end
	end)
end

local function stopForward()
	forwardEnabled = false
	forwardBtn.Text = "â–¶ï¸ Auto Forward"
	forwardBtn.BackgroundColor3 = Color3.fromRGB(0,120,0)
	statusLabel.Text = "Tráº¡ng thÃ¡i: Dá»«ng Forward"
	if forwardConnection then
		forwardConnection:Disconnect()
		forwardConnection = nil
	end
end

--====================================
-- Khi nhÃ¢n váº­t spawn thÃ¬ script tá»± Ä‘iá»u khiá»ƒn
--====================================
player.CharacterAdded:Connect(function(char)
	if not autoEnabled then return end
	task.wait(1)

	local humanoid = char:WaitForChild("Humanoid")
	local hrp = char:WaitForChild("HumanoidRootPart")

	-- Äi vá» Base sau khi spawn
	local baseFolder = workspace:FindFirstChild("Bases")
	if not baseFolder then return end
	local base = baseFolder:FindFirstChild(player.Name)
	if not base then return end

	local targetPos = base.Position + Vector3.new(0,3,0)

	task.spawn(function()
		while autoEnabled and humanoid and humanoid.Health > 0 do
			humanoid:MoveTo(targetPos)
			local reached = humanoid.MoveToFinished:Wait()
			if reached then
				local door = base:FindFirstChild("Door")
				if door and door:IsA("Part") then
					door.CanCollide = true
					door.Transparency = 0
					print("Base cá»§a "..player.Name.." Ä‘Ã£ Ä‘Æ°á»£c khÃ³a!")
				end
				break
			end
		end
	end)
end)

--====================================
-- NÃºt báº¥m GUI
--====================================
toggleBtn.MouseButton1Click:Connect(function()
	if autoEnabled then
		stopAuto()
	else
		local val = tonumber(timeBox.Text)
		if val and val > 0 then
			respawnTime = val
		end
		startAuto()
	end
end)

forwardBtn.MouseButton1Click:Connect(function()
	if forwardEnabled then
		stopForward()
	else
		startForward()
	end
end)
