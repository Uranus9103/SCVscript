-- LocalScript: StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- Config
local DEFAULT_WALK = 16
local SPRINT_WALK = 28
local VOID_Y = -120

----------------------------------------------------------------
-- FootPad + Anti-Die + Anti-Void
----------------------------------------------------------------
local function attachFootPad(character)
	local hrp = character:WaitForChild("HumanoidRootPart")
	local old = character:FindFirstChild("FootPad")
	if old then old:Destroy() end

	local pad = Instance.new("Part")
	pad.Name = "FootPad"
	pad.Size = Vector3.new(4, 0.2, 4)
	pad.Transparency = 0.2
	pad.Material = Enum.Material.Neon
	pad.Color = Color3.fromRGB(150, 255, 150)
	pad.CanCollide = false
	pad.Massless = true
	pad.Anchored = false
	pad.Parent = character

	local weld = Instance.new("WeldConstraint")
	weld.Part0 = pad
	weld.Part1 = hrp
	weld.Parent = pad
end

local function setupCharacter(char)
	local humanoid = char:WaitForChild("Humanoid")

	-- tốc độ mặc định
	humanoid.WalkSpeed = DEFAULT_WALK

	-- gắn footpad
	attachFootPad(char)

	-- anti die: luôn giữ máu đầy
	humanoid.HealthChanged:Connect(function()
		if humanoid.Health < humanoid.MaxHealth then
			humanoid.Health = humanoid.MaxHealth
		end
	end)

	-- anti void
	local hrp = char:WaitForChild("HumanoidRootPart")
	local lastSafeCF = hrp.CFrame
	RunService.Heartbeat:Connect(function()
		if humanoid.Health <= 0 then return end
		if hrp.Position.Y > 0 then
			lastSafeCF = hrp.CFrame
		end
		if hrp.Position.Y < VOID_Y then
			hrp.CFrame = lastSafeCF + Vector3.new(0, 5, 0)
			hrp.AssemblyLinearVelocity = Vector3.zero
			hrp.AssemblyAngularVelocity = Vector3.zero
		end
	end)
end

player.CharacterAdded:Connect(setupCharacter)
if player.Character then setupCharacter(player.Character) end

----------------------------------------------------------------
-- UI Nút "Chạy nhanh" (có thể kéo)
----------------------------------------------------------------
local gui = Instance.new("ScreenGui")
gui.Name = "SprintGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local btn = Instance.new("TextButton")
btn.Name = "SprintButton"
btn.Size = UDim2.new(0, 160, 0, 50)
btn.Position = UDim2.new(0.7, 0, 0.8, 0)
btn.Text = "Chạy nhanh: TẮT"
btn.TextScaled = true
btn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
btn.Parent = gui
btn.Active = true
btn.Draggable = true -- di chuyển được

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = btn

local stroke = Instance.new("UIStroke")
stroke.Thickness = 2
stroke.Parent = btn

local isOn = false
local function setBtn(on)
	isOn = on
	btn.Text = on and "Chạy nhanh: BẬT" or "Chạy nhanh: TẮT"
	btn.BackgroundColor3 = on and Color3.fromRGB(0, 255, 100) or Color3.fromRGB(0, 200, 0)
	if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
		player.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = on and SPRINT_WALK or DEFAULT_WALK
	end
end

btn.MouseButton1Click:Connect(function()
	setBtn(not isOn)
end)
